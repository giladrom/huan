<ion-header no-border>
  <ion-navbar id="navbar">
    <button ion-button menuToggle>
      <ion-icon name="menu" large></ion-icon>
    </button>

    <ion-title> <img id="logo" src="assets/imgs/huan-logo.png" /> </ion-title>

    <ion-buttons end>
      <button ion-button id="addpet" (click)="showMyPets()">Show Pets</button>
    </ion-buttons>
  </ion-navbar>
</ion-header>

<ion-content fullscreen no-padding no-bounce>
  <!-- Main Map Display -->




  <div #mainmap id="mainmap">
    <div *ngFor="let tag of (map$ | async); trackBy: trackByTags" id="shadow{{ tag.tagId }}" class="shadow"
      style="visibility: hidden" no-lines no-padding></div>

    <div *ngFor="let tag of (map$ | async); trackBy: trackByTags" id="pulse{{ tag.tagId }}" class="pulse"
      style="visibility: hidden" no-lines no-padding></div>

    <div *ngFor="let tag of (map_lost$ | async); trackBy: trackByTags" id="shadow{{ tag.tagId }}" class="shadow"
      style="visibility: hidden" no-lines no-padding></div>

    <div *ngFor="let tag of (map_lost$ | async); trackBy: trackByTags" id="pulse{{ tag.tagId }}" class="pulse"
      style="visibility: hidden" no-lines no-padding></div>

    <div *ngFor="let tag of (map_seen$ | async); trackBy: trackByTags" id="shadow{{ tag.tagId }}" class="shadow"
      style="visibility: hidden" no-lines no-padding></div>

    <div *ngFor="let tag of (map_seen$ | async); trackBy: trackByTags" id="pulse{{ tag.tagId }}" class="pulse"
      style="visibility: hidden" no-lines no-padding></div>

    <div *ngFor="let tag of (map$ | async); trackBy: trackByTags" id="info-window{{ tag.tagId }}" class="info-window"
      style="visibility: hidden" no-lines no-padding>
      <div class="info-window-title">{{ tag.name }}</div>
      <div class="info-window-subtitle">{{ getInfoWindowSubtitle(tag) }}</div>
    </div>

    <div *ngFor="let tag of (map_lost$ | async); trackBy: trackByTags" id="info-window{{ tag.tagId }}"
      class="info-window" style="visibility: hidden" no-lines no-padding>
      <div class="info-window-title">{{ tag.name }}</div>
      <div class="info-window-subtitle">{{ getInfoWindowSubtitle(tag) }}</div>
      <div class="info-window-subtitle">{{ getMarkedLostSubtitle(tag) }}</div>
    </div>

    <div *ngFor="let tag of (map_seen$ | async); trackBy: trackByTags" id="info-window{{ tag.tagId }}"
      class="info-window" style="visibility: hidden" no-lines no-padding>
      <div class="info-window-title">{{ tag.name }}</div>
      <div class="info-window-subtitle">{{ getInfoWindowSubtitle(tag) }}</div>
      <div class="info-window-subtitle">{{ getMarkedLostSubtitle(tag) }}</div>
    </div>

    <!-- <div *ngFor="let user of (active_users$ | async); trackBy: trackByTags" id="user{{ user.tagId }}" class="active-user" no-lines no-padding>
    </div> -->



  </div>
  <div *ngIf="welcome_banner" id="welcome-banner" class="hvr-pulse-grow" (click)="addTag()">
    <ion-icon id="welcome-banner-icon" name="paw"></ion-icon>
    <div id="welcome-banner-text">Welcome! Click here to add your first pet and get your tag.</div>
  </div>

  <div *ngIf="pack_leader" id="pack-leader">
    <ion-icon id="pack-leader-icon" name="star"></ion-icon>
    <div id="pack-leader-text">PACK LEADER</div>
  </div>


  <div *ngIf="review_banner" id="review-banner" class="hvr-pulse-grow" (click)="review()">
    <ion-icon id="review-banner-icon" name="thumbs-up"></ion-icon>
    <div id="review-banner-text">Do you like using Huan?</div>
  </div>


  <div *ngIf="!auth" id="monitoring-disabled" (click)="openLocationSettings()">
    <ion-icon id="location-disabled-icon" class="hvr-pulse-grow" name="navigate"></ion-icon>
    <div id="always-permission-text">'Always' Location Permission Disabled. <br>Pet Protection Inactive.</div>
  </div>

  <div *ngIf="auth && bluetooth && monitoring_enabled && number_of_tags <= large_number_of_tags" id="monitoring-enabled"
    (click)="sendInvite()">
    <ion-icon id="pet-protection-icon" name="checkmark-circle-outline"></ion-icon>
    <div id="pet-protection-text">
      Pet Protection Enabled
      <div id="protection-level">
        Level:
        <div [ngClass]=" { 
          'level-red': referral_score <= 1,
          'level-orange': referral_score == 2,
          'level-green': referral_score >= 3
        } " id="level"></div>
        <div [ngClass]=" { 
          'level-grey': referral_score < 2,
          'level-orange': referral_score == 2,
          'level-green': referral_score >= 3
        } " id="level"></div>
        <div [ngClass]=" {          
          'level-grey': referral_score < 3,
          'level-green': referral_score >= 3
        } " id="level"></div>
      </div>
    </div>
  </div>

  <div *ngIf="auth && !bluetooth" id="monitoring-disabled">
    <ion-icon id="bluetooth-disabled-icon" name="bluetooth"></ion-icon>
    <div id="pet-protection-text">Bluetooth Disabled. Pet Protection Inactive.</div>
  </div>

  <div *ngIf="auth && !monitoring_enabled && bluetooth" id="monitoring-disabled">
    <ion-icon id="pet-protection-disabled-icon" name="alert"></ion-icon>
    <div id="pet-protection-text">Pet Protection Disabled</div>
  </div>

  <div *ngIf="auth && bluetooth && number_of_tags > large_number_of_tags && monitoring_enabled" id="updates-delayed"
    (click)="sendInvite()">
    <ion-icon id="updates-delayed-icon" name="alert"></ion-icon>
    <div id="pet-protection-text">Large number of tags detected. Updates delayed.</div>
  </div>

  <div id="message-bubble" class="speech-wrapper">
    <div class="bubble">
      <div class="txt">
        <p class="name">Incoming Huan Message</p>
        <p class="message">Hi! I'll help you find your dog if you ever need me to!</p>
        <!-- <span class="timestamp">Now</span> -->
      </div>
      <div class="bubble-arrow"></div>
    </div>
  </div>


  <!-- <div #community id="community" (click)="showLeaderboard()">
    <div class="coverage">
      <div class="score">
        <div>{{ team_banner }}</div>
        <div>${{ amount_raised}} raised</div>

        <progress-bar
          [progress]="progress"
          [color-degraded]="{
            '0': '#ff564f',
            '33': '#ffc42f',
            '66': '#2dd043'
          }"
        >
        </progress-bar> 
        <div>{{ tags_required_for_next_level }} tags required to level up</div>
    </div>
  </div>
  </div> -->


</ion-content>
