<ion-header no-border>
  <ion-navbar color="primary"> <ion-title>Order Tags</ion-title> </ion-navbar>
</ion-header>

<ion-content fullscreen no-padding no-bounce>
  <form [formGroup]="orderForm" name="form" novalidate>
    <ion-grid class="product-grid">
      <!-- Products  -->

      <ion-row class="product-row">
        <ion-col
          [ngClass]="{
            'product-box': selected_product != product.product.id,
            active: selected_product === product.product.id
          }"
          *ngFor="let product of (products$ | async)"
          (click)="selectProduct(product.product.id)"
          id="{{ product.product.id }}"
        >
          <div>
            <img [src]="product.product.images[0]" />
            <div class="product-price">${{ product.sku.price / 100 }}</div>
          </div>
          <div class="product-name">{{ product.product.name }}</div>
          <div class="product-description">
            {{ product.product.description }}
          </div>
        </ion-col>
      </ion-row>

      <ion-row class="total-row">
        <ion-col col-6>
          <div class="product-name">{{ getItemList() }}</div>
        </ion-col>
        <ion-col col-6>
          <div class="product-name">${{ getTotalAmount() / 100 }}</div>
        </ion-col>
      </ion-row>
    </ion-grid>

    <!-- Apple Pay  -->

    <ion-row>
      <ion-col col-12>
        <div
          *ngIf="platform.is('ios') && apple_pay == 'enabled'"
          class="apple-pay-button-with-text apple-pay-button-black-with-text"
          (click)="payWithApplePay()"
        >
          <span class="text">Buy with</span> <span class="logo"></span>
        </div>

        <div
          *ngIf="platform.is('ios') && apple_pay == 'setup'"
          class="apple-pay-set-up-button apple-pay-button-black-with-text"
        >
          <span class="text">Buy with</span> <span class="logo"></span>
        </div>
      </ion-col>
    </ion-row>

    <!-- Pay with Card -->

    <ion-grid *ngIf="apple_pay != 'enabled'" class="card-grid">
      <ion-row>
        <ion-col>
          <div class="card-details">Shipping address and card details</div>
        </ion-col>
      </ion-row>
      <ion-row>
        <ion-col col-12>
          <ion-input
            id="address-input"
            type="text"
            autocomplete="name"
            [(ngModel)]="subscription.name"
            placeholder="Name"
            formControlName="name"
          ></ion-input>
        </ion-col>
      </ion-row>
      <ion-row>
        <ion-col col-12>
          <ion-input
            id="address-input"
            type="email"
            autocomplete="email"
            [(ngModel)]="subscription.email"
            placeholder="E-Mail"
            formControlName="email"
          ></ion-input>
        </ion-col>
      </ion-row>
      <ion-row>
        <ion-col col-12>
          <ion-input
            id="address-input"
            type="textarea"
            autocomplete="address-line1"
            [(ngModel)]="subscription.address1"
            placeholder="Address"
            formControlName="address1"
          ></ion-input>
        </ion-col>
      </ion-row>

      <ion-row>
        <ion-col col-6>
          <ion-input
            id="address-input"
            type="text"
            autocomplete="address-level2"
            [(ngModel)]="subscription.city"
            placeholder="City"
            formControlName="city"
          ></ion-input>
        </ion-col>
        <ion-col col-3>
          <ion-input
            id="address-input"
            type="text"
            autocomplete="address-level1"
            [(ngModel)]="subscription.state"
            placeholder="State"
            formControlName="state"
          ></ion-input>
        </ion-col>
        <ion-col col-3>
          <ion-input
            id="address-input"
            type="text"
            autocomplete="postal-code"
            [(ngModel)]="subscription.zipcode"
            placeholder="Zipcode"
            formControlName="zipcode"
          ></ion-input>
        </ion-col>
      </ion-row>

      <ion-row>
        <ion-col col-12>
          <div class="form-row">
            <div id="card-element"></div>
            <div id="card-errors" class="card-errors"></div>
          </div>
        </ion-col>
      </ion-row>

      <ion-row>
        <ion-col col-12 align="center">
          <button
            ion-button
            icon-right
            id="button6"
            type="submit"
            [disabled]="!orderForm.valid"
            (click)="payWithCreditCard()"
          >
            Pay ${{ getTotalAmount() / 100 }} with card
          </button>
        </ion-col>
      </ion-row>

      <ion-row>
        <ion-col col-12>
          <div class="stripe-logo">
            <img src="assets/imgs/powered_by_stripe@3x.png" />
          </div>
        </ion-col>
      </ion-row>
    </ion-grid>
  </form>
</ion-content>
